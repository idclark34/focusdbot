# FocusdBot

FocusdBot is a macOS menu bar focus companion with a Pomodoro timer, activity and media tracking, website/app allow‑lists, and optional AI session summaries. It runs as an accessory app (no dock icon) and displays a friendly robot avatar.

## Features
- Pomodoro flow with success/break phases
- Activity monitoring (frontmost app + window title) via Accessibility
- Safari website rules (Apple Events) and per‑app allowlist
- Media playback tracking (Music / Spotify notifications)
- Dashboard with daily stats and top apps
- Optional AI session summary via a proxy endpoint

## Requirements
- macOS 13.0+ (Ventura or newer)
- Xcode command line tools
- Accessibility permission (first run)
- Safari Apple Events permission for website rules

## Dev Run
```bash
cd watchdog
swift run FocusdBot
```
The robot appears in the menu bar. In the menu, enable Quick Test → 30s for fast cycles.

## Build (Release)
```bash
cd watchdog
swift build --configuration release --target FocusdBot
```

## Bundle the app (local)
```bash
cd /Users/ianclark/Desktop/watchdog/FocusedBot
rm -rf dist/FocusdBot.app
mkdir -p dist/FocusdBot.app/Contents/{MacOS,Resources}
# Info.plist (already generated by scripts); copy release binary
cp watchdog/.build/arm64-apple-macosx/release/FocusdBot dist/FocusdBot.app/Contents/MacOS/FocusdBot
cp AppIcon.png dist/FocusdBot.app/Contents/Resources/AppIcon.png
```

## Signing & Notarization
You need a paid Apple Developer account.

1) Developer ID cert in Keychain
```bash
security find-identity -v -p codesigning | grep "Developer ID Application"
```

2) Entitlements (once)
```bash
cat > entitlements.plist << 'PLIST'
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"><plist version="1.0"><dict>
  <key>com.apple.security.automation.apple-events</key><true/>
</dict></plist>
PLIST
```

3) Sign the app
```bash
export DEV_ID="Developer ID Application: YOUR NAME (TEAMID)"
rm -rf dist/FocusdBot.app/Contents/_CodeSignature
codesign --force --options runtime --timestamp \
  --entitlements entitlements.plist --deep --sign "$DEV_ID" \
  dist/FocusdBot.app
codesign -vv --deep --strict dist/FocusdBot.app
```

4) Create DMG (simple)
```bash
hdiutil create -srcfolder dist/FocusdBot.app -volname "FocusdBot" -format UDZO FocusdBot-1.0.0.dmg
```

5) Notarize (App‑specific password OR API key)
- App‑specific password profile example:
```bash
xcrun notarytool store-credentials --apple-id "you@example.com" --team-id TEAMID --password "APP_SPECIFIC_PASSWORD" AC_NOTARY
xcrun notarytool submit FocusdBot-1.0.0.dmg --keychain-profile AC_NOTARY --wait --progress
```
- API key (recommended):
```bash
xcrun notarytool submit FocusdBot-1.0.0.dmg \
  --team-id TEAMID --key-id KEYID --issuer ISSUERID --key /path/AuthKey_KEYID.p8 \
  --wait --progress
```

6) Staple
```bash
xcrun stapler staple FocusdBot-1.0.0.dmg
```

## Troubleshooting
- Extended attributes (FinderInfo/provenance) can break codesign. Build/sign outside iCloud‑synced folders, or strip attributes:
```bash
xattr -cr dist/FocusdBot.app
```
- If notarization “In Progress” for >30 min, resubmit or use API key auth.

## Release (GitHub)
```bash
# tag
git tag -a v1.0.0 -m "FocusdBot v1.0.0"
git push origin v1.0.0

# upload asset (requires GitHub CLI)
gh release create v1.0.0 ./FocusdBot-1.0.0.dmg -t "FocusdBot v1.0.0" -n "Signed + notarized. macOS 13+."
```

## Optional: AI Summary
Set an environment variable to point to your proxy:
```bash
export FOCUSD_PROXY_URL="https://your-proxy.workers.dev"
# optional client secret header passthrough
export FOCUSD_CLIENT_SECRET="your-shared-secret"
```

## Data Location
SQLite DB at `~/Library/Application Support/Focusd/focusd.sqlite`.

---
© 2025 FocusdBot. MIT-style usage within this repo unless otherwise specified.
